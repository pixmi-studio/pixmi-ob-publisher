# Specification: Isolated Preview Window

## Overview
The current preview implementation suffers from CSS conflicts with Obsidian's internal styles, leading to an inaccurate representation of the final WeChat draft. This track replaces the integrated preview with a dedicated, isolated preview window that only loads theme-specific styles, ensuring "What You See Is What You Get" (WYSIWYG) accuracy.

**Crucially, this track effectively reverts previous attempts to modify Obsidian's native preview pane, restoring the default Markdown preview behavior within the main app.**

## Functional Requirements
- **Legacy Cleanup:**
    - Remove all existing code that injects styles or modifies the DOM of Obsidian's native preview pane/editor view.
    - Ensure Obsidian's standard "Reading View" and "Live Preview" behave exactly as they would without the plugin active.
- **Trigger Mechanism:** Register a new command "Open WeChat Publisher Preview" in the Obsidian Command Palette.
- **Window Management:** 
    - Open a separate window (via Electron `BrowserWindow` or Obsidian's `window.open` equivalent).
    - Ensure the window is manageable (can be closed, resized, and brought to front).
- **Real-time Synchronization:** 
    - The preview content must update automatically in real-time as the user types in the active Markdown editor.
    - Synchronization should handle switching between different active notes.
- **Strict Style Isolation:**
    - The preview window must NOT load Obsidian's global styles (`app.css`, community themes, or other plugin styles).
    - Inject ONLY the CSS generated by the plugin's theme engine to guarantee that the preview matches the final WeChat output.
- **Content Rendering:** Use the plugin's existing Markdown-to-HTML conversion logic to ensure consistency.

## Non-Functional Requirements
- **Performance:** Synchronization should be low-latency to provide a smooth editing experience.
- **Reliability:** Handle edge cases such as the preview window being closed by the user or the plugin being disabled.

## Acceptance Criteria
- [ ] A command exists to open the preview window.
- [ ] The preview window opens correctly and displays the content of the active note.
- [ ] Editing the note in Obsidian updates the preview window content immediately.
- [ ] The preview window's visual appearance is independent of the current Obsidian theme.
- [ ] **Obsidian's native "Reading View" and "Live Preview" are completely unaffected by the plugin's styling.**
- [ ] Closing the preview window and re-opening it works without errors.

## Out of Scope
- Support for multiple simultaneous preview windows for different notes.
- Interacting with the preview window (e.g., clicking links should be disabled or limited).
